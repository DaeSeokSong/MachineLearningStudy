[9. 형태학적 영상 처리]
[9.1 서론]
수학적 형태학의 체계는 집합 이론이다. 형태학은 많은 영상처리 문제에 대한 접근법을 제시한다.
수학적 형태학의 집합은 영상의 객체를 나타낸다.
영상의 객체를 표현하는 화소의 집합의 반사는 대칭점들의 집합이다.
집합의 반사와 이동은 구조 요소(SE)에 기반한 연산들을 공식화하는 형태학에서 널리 사용된다.
구조 요소란 작은 집합 또는 부영상으로서 관심특성에 관한 탐구 대상 영상을 위한 조사에 사용된다.
구조 요소들의 원점들이 표시되며, 대칭이고 점이 보이지 않으면 원점은 대칭의 중심에 위치한다.
영상 처리에서 구조 요소가 직각사각형 배열이어야 한다. 때문에 직각사각형이 아니라면 최소의 배경 요소들을 추가하여 구조 요소를 직각사각형으로 만든다.
배경 경계는 구조 요소의 원점이 원래 집합의 경계에 있을 때, 전체 구조 요소가 놓일 수 있을 정도로 크게 만들어 진다.

[9.2 침식과 팽창]
[9.2.1 침식]
집합 A, B가 있을 때, B에 의한 A의 침식은 A - B로 표기된다.
z에 의해 이동된 B가 A에 포함되는 모든 점 z의 집합이다.
B의 요소를 지나는 A의 원점의 모든 좌표의 집합을 표현함으로써 B의 크기가 작아지는 것을 뜻한다.
면에서 선이 되기도 한다.
즉, 침식이 이진 영상의 객체를 축소 또는 가늘게 만들 수 있다.
구조 요소보다 작은 영상 디테일들이 영상에서 필터링(제거)되는 형태학적 필터링 연산으로 볼 수 있다.
[9.2.2 팽창]
집합 A, B가 있을 때, B에 의한 A의 팽창은 A + B로 표기된다.
B를 원점에 대해 반사시킨 후, z만큼 이동시키는 것이 기반한다. 때문에 B에 의한 A의 팽창은 B의 반사와 A가 적어도 한 요소는 겹치게 만드는 모든 이동 z의 집합이다.
B는 구조요소, A는 팽창될 집합(객체) 일 때, B를 컨볼루션 마스크로 원점에 대해 뒤집은(회전시킨) 후 집합(영상) A의 위에서 이동시키는 공간 컨볼루션과 유사한 연산을 수행한다.
하지만 팽창은 집합 연산에 기반하는 비선형 연산이고, 컨볼루션은 선형 연산이다.
A의 경계부터 내부의 점까지 지나는 B의 원점의 z이동 집합이 팽창 집합이다.
축소 또는 세션화 연산인 침식과 달리, 팽창은 이진 영상에서 객체들을 커지게 또는 두꺼워지게 만든다.
팽창의 가장 간단한 응용 중 하나는 틈을 메우는 것이다.
[9.2.3 쌍대성]
침식과 팽창은 집합의 상보(complementation)와 반사에 대하여 서로에 대해 반대이다.
즉, B에 의한 A의 침식이, B의 대칭에 의한 A 여집합의 팽창의 보집합 또는 그 역임을 나타낸다.
쌍대성(Duality) 특성은 구조 요소가 그 원점에 대해 대칭이어서 B의 반사 = B 일때 유용하다.
B에 의한 어떤 영상의 침식을 똑같은 구조 요소로 그 배경을 팽창시키고, 그 결과의 보집합을 취하여 얻을 수 있다.

[9.3 열기와 닫기]
팽창은 영상의 성분을 확대시키고, 침식은 축소시킨다.
열기는 객체의 윤곽을 부드럽게 만들고, 좁은 지협(isthmus)을 끊고, 가느다란 돌출부를 제거한다.
닫기는 윤곽을 부드럽게 만드는 경향이 있으나, 열기와는 반대로 윤곽의 좁은 끊김과 길고 가는 틈을 붙이고, 작은 홀은 제거하며 간극을 채운다.
B에 의한 A의 열기는 B에 의한 A의 침식 후 그 결과를 B에 의해 다시 팽창시키는 것이다.
B에 의한 A의 닫기는 B에 의한 A의 팽창 후 그 결과를 B에 의해 다시 침식시키는 것이다.
열기 연산은 구조 요소 B를 구르는 공으로 보고, B가 A의 경계 안에서 굴러다니며 가장 깊이 도달하는 B의 점들에 대해 설정된다.
열기 연산의 기하학적 맞춤 특성은 A 안에 맞는 B의 모든 이동의 합집합을 취함으로써 B에 의한 A의 열기가 얻어진다는 집합-이론적 표현으로 이끈다.
닫기는 열기와 비슷한 기하학적 해석을 가지나, B를 경계의 바깥에서 굴린다는 점이 다르다.
팽창과 침식의 경우와 같이, 열기와 닫기는 집합의 상보와 반사에 대해 서로 반대이다.
열기 연산은 다음과 같은 특성들을 충족한다.
	1. B에 의한 A의 열기 연산은 A의 부분집합(부영상)이다.
	2. 만일 C가 D의 부분집합이면, B에 의한 C의 열기 연산은 B에 의한 D의 열기의 부분집합이다.
	3. B에 의한 A의 열기 연산의 결과에 의한 B의 열기 연산은 B에 의한 A의 열기 연산과 같다.
닫기 연산은 다음과 같은 특성들을 충족한다.
	1. B에 의한 A의 닫기 연산은 A의 부분집합(부영상)이다.
	2. 만일 C가 D의 부분집합이면, B에 의한 C의 닫기 연산은 B에 의한 D의 닫기의 부분집합이다.
	3. B에 의한 A의 닫기 연산의 결과에 의한 B의 닫기 연산은 B에 의한 A의 닫기 연산과 같다.
즉, 3번 보전으로부터 한 집합에 대해 열기 또는 닫기 연산을 한 번 적용하면, 반복 적용이 효과가 없음을 알 수 있다.
선의 연결성을 유지하지 위해서는 조건을 제시하여야 한다.

[9.4 적중-비적중 변환]
형태학적 적중-비적중(hit-or-miss) 변환은 모양 검출을 위한 기본적인 도구이다.
A에서의 B의 일치 집합은 객체와 관련된 B의 요소들을 A에서, 해당 배경과 관련된 B의 요소들을 A의 여집합에서 일치를 찾아낸 모든 점(원점)을 포함한다.
객체와 관련된 구조요소와 배경과 관련된 요소를 사용하는 이유는 둘 이상의 객체들이 분리된 집합들을 형상하면 서로 다르다는 가정에 기반한다.
이 가정은 주위에 적어도 1 화소 두께 배경을 가진다면 보장할 수 있다.
집합 안의 1 또는 0의 일정한 패턴(조합)을 검출해야 한다면, 적중-비적중 변환은 간단한 침식으로 축소된다.
침식은 일치들의 집합이지만, 개별 객체를 검출하기 위해 배경 일치를 추가로 필요하지는 않는다.

[9.5 기초 형태학적 알고리즘들]
형태학의 주요 응용들 중 하나는 모양의 표현 및 묘사에 유용한 영상 성분들을 추출하는 데 있다.
영역의 경계, 연결 성분, 볼록 깍지, 골격을 추출하는 형태학적 알고리즘들을 고찰한다.
외에도 세선화, 후선화(thickening), 가지치기(pruning)도 전개한다.
[9.5.1 경계 추출]
집합 A의 경계는 A를 B에 의해 침식시킨 후, A와 그 침식 결과 간의 차집합을 계산해서 얻을 수 있다. B는 구조요소이다.
[9.5.2 홀 채우기]
홀(Hole)은 전경 화소들의 연결된 경계로 둘러싸인 배경 영역이라고 정의될 수 있다.
영상의 홀을 매우기 위해 집합 팽창, 상보, 교차에 기반한 알고리즘을 전개한다.
A를 포함하는 배열과 같은 크기이나, 각 홀의 주어진 점에 해당하는 위치만 1로 설정하고 나머지는 모두 0인 배열로 만드는 것에서 시작한다. 그 후 모든 홀을 1로 채운다.
여기서 사용되는 팽창은 조건부로서 작용한다.
[9.5.3 연결 성분 추출]
A가 하나 이상의 연결 성분을 포함하는 집합이라하면, 1(전경)로 설정할 각 연결 성분의 한 점에 해당하는 것으로 알려진 각 위치를 제외하고, 요소들이 0(배경)인 배열을 만든다.
목표는 적당한 구조 요소로 해당 배열에서 모든 연결 성분을 반복 절차를 통해 찾는 것이다.
각 연결 성분의 한 점이 미리 알려져 있을 필요가 없어도 추출 가능하다.
[9.5.4 볼록 깍지]
집합 A는 A 안의 임의의 두 점을 연결하는 직선 선분이 A 안에 완전하게 놓인다면 볼록(convex)하다고 불린다.
임의의 집합 S의 볼록 깍지(convex hull) H는 S를 포함하는 가장 작은 볼록 집합이다.
H - S 차집합은 S의 볼록 결여(convex deficiency)라고 불린다.
볼록 깍지와 볼록 결여는 객체 묘사에 유용하다. 집합 A의 볼록 깍지 C(A)는 적중-비적중을 반복적으로 적용하는 것으로 구성된다.
이는 배경 일치가 요구되지 않는 적중-비적중 변환의 단순화된 구현을 사용하고 있는 것이다.
무관심 조건을 가진 원점을 중심으로 한 3*3 마스크를 90도씩 돌린 각 마스크드르이 패턴 일치를 통해 얻어지는 영역들을 겹치는 것으로 볼록 깍지를 얻을 수 있다.
볼록 깍지가 볼록성을 보장하는 데 필요한 원래 점 집합의 수평 및 수직 크기를 지나서 확장되지 않게 성장을 제한한다.
이러한 성정 제한을 더 복잡한 경계로 할 수 있으며, 이런 세밀함을 위해서는 복잡성이 증가하여 계산 요구량이 증가하게 된다.
[9.5.5 세선화]
구조 요소 B에 의한 집합 A의 세선화는 적중-비적중 변환에 의해 정의될 수 있다.
구조 요소와의 패턴 매칭에만 관심이 있으므로, 적중-비적중 변환에서 배경 연산이 필요하지 않다.
A를 대칭적으로 세선화하기 위한 더 유용한 표현인 구요 요소 시퀀스에 기반한다.
구조 요소 B를 회전시킨 집합을 A에 반복적으로 적용해가며 이런 반복적인 프로세스가 변화가 없을 때까지 진행된다.
다중 경로를 없애기 위해 m-연결성으로 바뀐 세선화 집합을 쓸 수도 있다.
[9.5.6 후선화]
후선화(thickening)은 세선화에 대한 역이며, 세선화와 마찬가지로 순차적 연산으로 정의된다.
구조 요소는 똑같은 모양을 가지나, 1과 0의 자리가 뒤바뀐다.
별도의 후선화 알고리즘은 실제로 거의 사용되지 않는다. 집합 A를 후선화 하기 위해서는 A의 여집합을 만들고 그를 세선화하고, 세선화 결과의 여집합을 만든다.
이러한 절차에 의해 끊김 점들이 나올 수 있다. 이러한 점들을 제거하기 위한 후처리가 뒤따른다.
세선화된 배경이 후선화 과정의 경계를 형성한다. 이는 후선화를 하기 위해 배경 세선화를 하는 이유 중 하나이다.
[9.5.7 골격]
골격은 침식과 열기(Open)에 의해 표현될 수 있다.
B는 구조 요소이며, A에 대한 k회의 연속 침식을 진행하게 된다. 여기서 공집합으로 침식되지 전 마지막 반복 단계를 K라 한다.
이후 k회의 연속적 팽창을 표시한다. 마지막으로 집합 A의 복구를 하는데 이는 팽창된 골격 부분 집합들의 합집합이다.
[9.5.8 가지치기]
세선화 및 골격화 알고리즘에 대한 가장 중요한 보완 방법이다. 이들이 후처리에 의해 제거될 필요가 있는 기생적 성분들을 남겨두기 때문이다.
필기체의 골격들은 흔히 지선(spur)(기생 성분)에 의해 특징지어진다. 지선은 글자를 구성하는 획들의 불균일성에 의해 침식 때 야기된다.
기생 성분에 대한 해결책은 끝 점을 연속으로 제거해서 기생적 지선을 삭제하는 데 기반한다.
다른 지선들도 단축(또는 제거)시키지만, 다른 구조 정보가 없다면 특정 화소 이하 지선은 모두 제거될 것이다.
끝점들만 검출하도록 설계된 구조 요소 시퀀스로 집합 A를 세선화 하면 원하는 결과를 얻을 수 있다.
기생 지선들을 제거했으면 글자를 복원해야 한다. 때문에, 모든 끝점을 포함하는 집합을 형성해야 한다.
또는 기생 지선들의 끝을 찾아낼 수도 있다. 이는 지선들의 끝점들이 골격 근처에 있을 때나 가능하다.
[9.5.9 형태학적 복구]
두 개의 영상과 하나의 구조 요소를 사용하는 형태학적 복구라는 강력한 형태학적 변환이다.
마커(Marker)는 이 변환을 위한 시작점을 포함한다. 나머지 영상, 즉 마스크는 변환을 담고있다.
구조 요소는 연결성을 정의하는 데 사용된다.
최단선 팽창과 침식은 형태학적 복구의 핵심이다.
최단선 팽창과 침식은 서로 듀얼(역)이다. 유한한 영상의 최단선 팽창과 침식은 한상 유한한 반복 단계 후에 수렴한다. 이는 마커 영상의 확대 또는 수축이 마스크에 의해 제한되기 때문이다.
팽창, 침식에 의한 형태학적 복구는 안정에 도달할 때까지 반복되는 마스크에 대한 최단선 팽창으로 정의된다.
팽창에 의한 복구는 최단선 팽창을 얻고 이를 팽창시키고 마스크 G와 AND연산하여 또 최단선 팽창을 얻는다. 이를 안정에 도달할 때까지 진행한다. 복구된 영상은 마스크와 동일하다.
마찬가지로 침식에 의한 형태학적 복구는 안정에 도달할 때까지 앞선 과정과 동일하게 팽창 대신 최단선 침식을 이용하여 반복한다.
형태학적 복구는 실제로 많은 분야에서 응용되고 있으며 그 중 복구에 의한 열기(Open)이 있다.
형태학적 열기에서, 침식이 작은 객체들을 제거하며, 팽창은 남은 객체들의 모양에 대한 복원을 시도한다.
이 복원의 정확도는 객체들의 모양과 사용되는 구조 요소의 유사성에 의해 크게 좌우된다.
그러나, 복구에 의한 열기는 침식 후 남는 객체들의 모양을 정확하게 복원한다. 복구에 의한 닫기도 열기와 같은 프로세스로 정의될 수 있다. 예시로 글자 복원이 있다.
다른 응용 예시로 홀 채우기를 들 수 있다. 각 홀의 시작 점을 안 다는 가정하에 홀을 채우는 알고리즘을 전개했으나, 형태학적 복구에 기반하면 이러한 가정이 없어도 된다.
마지막 예시로 경계 청소가 있다. 영상 분석을 위해 영상으로부터 객체를 추출하는 것은 필수적인 작업이다.
경계에 닿은(연결된) 객체들을 제거하기 위한 알고리즘은 온전한 객체들만 남도록 영상을 스크리닝 하는 데 사용되거나, FOV(field of view)에 부분적 객체들이 존재하는 신호로서 사용될 수 있어서 유용한 도구이다.
만약 자동 글자 인식이라면, 부분 글자를 인식해야 하는 문제를 피하도록, 경계에 닿은 글자가 없는 영상이 가장 바람직하기에 이러한 응용이 사용된다.

[9.6 그레이-스케일 형태학]
팽창, 침식, 열기, 닫기를 그레이-스케일 영상으로 확장한다.
그레이-스케일 형태학에서의 구조 요소들은 그들의 이진 카운터파트들과 똑같은 기능을 수행한다.
지정된 특성에 관하여 주어진 영상을 조사하기 위해 탐침(prode)으로서 사용된다.
구조 요소들은 평탄과 비평탄 중 하나에 속한다.
[9.6.1 침식과 팽창]
임의의 위치 (x, y)에서의 평탄 구조 요소에 의한 침식은 원점이 (x, y)에 있을 때, 구조 요소와 일치하는 영역에서의 영상의 최소값으로 정의된다.
예를 들어 3*3 정사각형 구조 요소라면, 어떤 점에서의 침식을 구할 때, 구조 요소의 원점이 해당 점에 있을 때 3*3 영역에 포함된 9개의 값들 중 최소값을 찾는다.
마찬가지로 팽창은 구조요소의 원점이 (x, y)에 있을 때 구조 요소에 의해 정해지는 윈도우에 있는 영상의 최대값으로 정의된다.
이러한 연산들은 공간 컨볼루션과 유사하다.
일반적으로, 침식된 그레이-스케일 영상이 원본보다 더 어두둘 것이며, 밝은 특징들의 크기가 축소되고 어두운 특징들의 크기는 증가할 것이다.
팽창은 반대로, 밝은 특징들이 굵어지며, 어두운 특징들의 밝기는 줄어든다.
[9.6.2 열기와 닫기]
열기는 단순히 구조 요소에 의해서 영상을 침식시키고, 그 결과에 대해서 팽창시키는 것이다.
닫기는 반대로 팽창시킨 후 침식시키는 것이다.
그레이-스케일 영상에 대한 열기와 닫기는 여영상과 SE 반사에 관한 역이다.
일반적으로 열기는 작고 밝은 디테일을 제거하기 위해 사용되는데, 동시에 전반적인 밝기 레벨과 더 밝은 특징들은 상대적으로 침해되지 않은 상태로 남는다.
닫기는 반대로 어두운 디테일을 제거하기 위해 사용된다.
[9.6.3 기본적 그레이-스케일 형태학 알고리즘들]
[형태학적 스무딩] 열기는 구조요소보다 작은 밝은 디테일을 억압하며, 닫기는 어두운 디테일을 억압하므로, 이 둘이 결합하여 영상 스무딩과 노이즈 제거용 형태학 필터로 자주 사용된다.
이전 단계의 결과에 대해 열기와 닫기를 수행하는 ASF(교번 순차 필터링)을 수행하기도 한다.
이 유형의 필터링은 각 단계에서의 결과가 지정된 측정 기준과 비교되는 자동 영상 분석에 유용하다.
[형태학적 기울기 연산] 형태학적 기울기를 얻기 위해서는 영상의 팽창 - 침식을 이용한다.
팽창은 영상의 영역을 두텁게 만들며, 침식은 축소시킨다. 이들의 차이는 영역 간의 경계를 강조한다.
동질적인 영역들은 영향을 받지 않으므로, 뺄셈 연산에 의헤 제거되는 경향이 있다.
최종 결과는 에지가 개선되고 동질적 영역들은 억압된 영상이라 미분(기울기) 효과를 제공한다.
[Top-hat 변환과 Bottom-hat 변환] 영상 뺄셈을 영기 및 닫기와 결합시키면 소위 top-hat 변환과 bottom-hat 변환을 얻는다.
top-hat 변환은 영상 - 영상의 열기로 정의되고 bottom-hat 변환은 영상 - 영상의 닫기로 정의된다.
주요 응용 분야 중 하나는 열기 또는 닫기 연산에서 제거되 개체에 맞지 않는 구조 요소를 사용해서 영상으로부터 개체를 제거하는 것이다. 제거된 요소들만 남아있는 영상을 제공한다.
top-hat 변환은 어두운 배경의 밝은 개체를 위해서 사용되며, bottom-hat 변환은 그 반대 목적으로 사용된다.
때문에 각각 백색 top-hat, 흑색 top-hat이라는 이름으로도 종종 불린다.
top-hat 변환의 중요 용도는 비균일 조명의 효과를 보정하는 것이다. 적정한(균일한) 조명이 배경으로부터 개체를 추출하는 과정에서 중심적인 역할을 한다.
분할이라고 불리는 과정은 자동 영상 분석에서 수행되는 맨 처음 단계들 중 하나이다.
흔히 사용되는 분할 접근법은 입력 영상을 문턱치 처리하는 것이다.
[입도측정(Granulometry)] 입도측정은 영상의 입자들의 크기 분포를 계산한느 것을 다루는 분야이다.
실제 문제에서 입자는 깔끔하게 분리되어 있는 일이 거의 없으며, 때문에 입자를 하나씩 구분해서 세는 것은 어렵다.
형태학은 영상의 모든 입자를 식별하고 측량할 필요 없이 입자 크기 분포를 간접적으로 추정하는 데 사용될 수 있다.
배경보다 밝은 규칙적인 모양을 갖는 입자들에 대해서, 더 큰 열기들을 적용하는 것으로 구성된다.
기본 개념은 특정 크기의 열기 연산이 비슷한 크기의 입자들을 포함하는 입력 영상 영역들에 가장 큰 영향을 주어야 한다는 것이다.
각 열기에 대해, 열기 때의 화소 값들의 합이 계산된다. 이 합은 표면적으로 불리기도 하며, SE(구조 요소)가 커짐에 따라 감소하는데, 열기가 밝은 특징들을 감소시키기 때문이다.
이 절차에서 그런 숫자들의 1차원 배열을 만드는데, 배열의 각 요소는 배열에서의 그 위치에 해당하는 크기의 구조 요소에 대한 열기 때의 화소들의 합과 같다.
연속적 열기들 간의 변화를 강조하기 위해 그 차이를 그래프로 나타낸다.
그래프의 피크들은 영상의 입자들의 두드러진 크기 분포를 나타낸다. 해당 그래프로 두드러진 객체 크기가 있는지 알 수 있다.
[텍스쳐 분할] 영상을 부영역들로 나누는 프로세스를 분할이라고 부른다.
관심 객체는 배경보다 더 어두우며, 작은 얼룩들보다 더 큰 구조요소로 영상 닫기를 수행하면, 얼룩들이 제거될 것이다.
얼룩간의 간격에 비해 큰 구조 요소로 열기를 수행하면, 결과는 얼룩들 간의 밝은 패치가 제거되며, 어두운 얼룩들은 남고, 얼룩들 간은 이들의 밝기만큼 어두운 패치들로 메워진다.
[9.6.4 그레이-스케일 형태학적 복구]
마커 영상과 마스크 영상은 같은 크기의 그레이-스케일 영상이며, 마스크 영상이 더 크다.
크기 1의 최단선 팽창은 구조 요소에 의한 마커 영상의 팽창을 계산한 후 모든 점 (x, y)에 대하여 결과와 마스크 간의 최소값을 선택해서 얻어진다.
최단선 침식은 이에 역이다.
그레이-스케일 마커 영상에 의한 그레이-스케일 마스크 영상의 팽창에 의한 형태학적 복구는 안정에 도달할 때까지 반복되는 최단선 팽창으로 정의된다. 침식에 의한 형태학적 복구도 비슷하게 정의된다.
그레이-스케일 영상의 복구에 의한 열기는 먼저 입력 영상을 침식시키고, 그것을 마커로 이용한다.
영상의 크기 n의 복구에 의한 열기는 영상의 크기 n의 침식으로부터의 영상의 팽창에 의한 복구이다.
영상의 크기 n의 복구에 의한 닫기는 영상의 크기 n의 팽창으로부터의 영상의 침식에 의한 복구이다.
영상의 복구에 의한 닫기는 영상을 반전시키고, 복구에 의한 열기를 얻은 뒤 반전시켜 얻을 수 있다.
복구에 의한 top-hat은 영상으로부터 그 복구에 의한 열기를 빼는 것으로 구성된다.